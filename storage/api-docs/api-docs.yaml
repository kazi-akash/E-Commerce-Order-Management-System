openapi: 3.0.3
info:
  title: E-Commerce Order Management API
  description: |
    REST API for an order management system with inventory tracking.
    
    ## Features
    - JWT authentication with refresh tokens
    - Role-based access control (Admin, Vendor, Customer)
    - Product management with variants
    - Order processing with status workflow
    - Real-time inventory tracking
    - Low stock alerts
    
    ## Authentication
    All protected endpoints require a Bearer token in the Authorization header.
    
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: http://localhost:8000/api/v1
    description: Local development server
  - url: https://api.example.com/v1
    description: Production server

tags:
  - name: Authentication
    description: User authentication and token management
  - name: Products
    description: Product management operations
  - name: Orders
    description: Order management operations
  - name: Inventory
    description: Inventory management operations

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token obtained from login endpoint

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: John Doe
        email:
          type: string
          format: email
          example: john@example.com
        role:
          type: string
          enum: [admin, vendor, customer]
          example: customer
        phone:
          type: string
          nullable: true
          example: "+1234567890"
        address:
          type: string
          nullable: true
          example: "123 Main St, City, Country"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Product:
      type: object
      properties:
        id:
          type: integer
          example: 1
        vendor_id:
          type: integer
          example: 2
        category_id:
          type: integer
          nullable: true
          example: 1
        name:
          type: string
          example: "ProBook Elite 15"
        slug:
          type: string
          example: "probook-elite-15"
        sku:
          type: string
          example: "LAPTOP-001"
        description:
          type: string
          nullable: true
          example: "High-performance laptop"
        base_price:
          type: number
          format: decimal
          example: 1299.99
        has_variants:
          type: boolean
          example: true
        is_active:
          type: boolean
          example: true
        low_stock_threshold:
          type: integer
          example: 10
        images:
          type: array
          items:
            type: string
          example: ["laptop1.jpg", "laptop2.jpg"]
        meta_data:
          type: object
          nullable: true
        vendor:
          $ref: '#/components/schemas/User'
        variants:
          type: array
          items:
            $ref: '#/components/schemas/ProductVariant'
        inventory:
          $ref: '#/components/schemas/Inventory'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ProductVariant:
      type: object
      properties:
        id:
          type: integer
          example: 1
        product_id:
          type: integer
          example: 1
        sku:
          type: string
          example: "LAPTOP-001-V1"
        name:
          type: string
          example: "16GB RAM / 512GB SSD"
        attributes:
          type: object
          example: {"ram": "16GB", "storage": "512GB"}
        price:
          type: number
          format: decimal
          example: 1299.99
        is_active:
          type: boolean
          example: true
        inventory:
          $ref: '#/components/schemas/Inventory'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Inventory:
      type: object
      properties:
        id:
          type: integer
          example: 1
        inventoriable_type:
          type: string
          example: "App\\Models\\Product"
        inventoriable_id:
          type: integer
          example: 1
        available_quantity:
          type: integer
          example: 50
        reserved_quantity:
          type: integer
          example: 5
        last_restocked_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Order:
      type: object
      properties:
        id:
          type: integer
          example: 1
        order_number:
          type: string
          example: "ORD-20241120-ABC123"
        customer_id:
          type: integer
          example: 5
        status:
          type: string
          enum: [pending, processing, shipped, delivered, cancelled]
          example: "pending"
        subtotal:
          type: number
          format: decimal
          example: 1299.99
        tax:
          type: number
          format: decimal
          example: 104.00
        shipping_fee:
          type: number
          format: decimal
          example: 15.00
        discount:
          type: number
          format: decimal
          example: 0.00
        total:
          type: number
          format: decimal
          example: 1418.99
        currency:
          type: string
          example: "USD"
        shipping_address:
          type: string
          nullable: true
        billing_address:
          type: string
          nullable: true
        customer_email:
          type: string
          nullable: true
        customer_phone:
          type: string
          nullable: true
        notes:
          type: string
          nullable: true
        customer:
          $ref: '#/components/schemas/User'
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        confirmed_at:
          type: string
          format: date-time
          nullable: true
        shipped_at:
          type: string
          format: date-time
          nullable: true
        delivered_at:
          type: string
          format: date-time
          nullable: true
        cancelled_at:
          type: string
          format: date-time
          nullable: true
        cancellation_reason:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    OrderItem:
      type: object
      properties:
        id:
          type: integer
          example: 1
        order_id:
          type: integer
          example: 1
        product_id:
          type: integer
          example: 1
        product_variant_id:
          type: integer
          nullable: true
          example: 1
        product_name:
          type: string
          example: "ProBook Elite 15"
        product_sku:
          type: string
          example: "LAPTOP-001-V1"
        variant_attributes:
          type: object
          nullable: true
          example: {"ram": "16GB", "storage": "512GB"}
        quantity:
          type: integer
          example: 1
        unit_price:
          type: number
          format: decimal
          example: 1299.99
        subtotal:
          type: number
          format: decimal
          example: 1299.99
        tax:
          type: number
          format: decimal
          example: 104.00
        total:
          type: number
          format: decimal
          example: 1403.99

    AuthResponse:
      type: object
      properties:
        message:
          type: string
          example: "Login successful"
        data:
          type: object
          properties:
            access_token:
              type: string
              example: "eyJ0eXAiOiJKV1QiLCJhbGc..."
            refresh_token:
              type: string
              example: "abc123def456..."
            token_type:
              type: string
              example: "Bearer"
            expires_in:
              type: integer
              example: 3600
            user:
              $ref: '#/components/schemas/User'

    Error:
      type: object
      properties:
        message:
          type: string
          example: "Error message"
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string

    PaginatedProducts:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Product'
        current_page:
          type: integer
          example: 1
        per_page:
          type: integer
          example: 15
        total:
          type: integer
          example: 100
        last_page:
          type: integer
          example: 7

    PaginatedOrders:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Order'
        current_page:
          type: integer
          example: 1
        per_page:
          type: integer
          example: 15
        total:
          type: integer
          example: 50
        last_page:
          type: integer
          example: 4

paths:
  /register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Create a new user account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
                - password_confirmation
              properties:
                name:
                  type: string
                  example: "John Doe"
                email:
                  type: string
                  format: email
                  example: "john@example.com"
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: "password123"
                password_confirmation:
                  type: string
                  format: password
                  example: "password123"
                role:
                  type: string
                  enum: [admin, vendor, customer]
                  default: customer
                  example: "customer"
                phone:
                  type: string
                  example: "+1234567890"
                address:
                  type: string
                  example: "123 Main St"
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /login:
    post:
      tags:
        - Authentication
      summary: Login user
      description: Authenticate user and receive access and refresh tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "admin@example.com"
                password:
                  type: string
                  format: password
                  example: "password"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Get a new access token using refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh_token
              properties:
                refresh_token:
                  type: string
                  example: "abc123def456..."
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Token refreshed"
                  data:
                    type: object
                    properties:
                      access_token:
                        type: string
                      token_type:
                        type: string
                        example: "Bearer"
                      expires_in:
                        type: integer
                        example: 3600
                      user:
                        $ref: '#/components/schemas/User'
        '401':
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      description: Revoke refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh_token
              properties:
                refresh_token:
                  type: string
                  example: "abc123def456..."
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Logout successful"

  /me:
    get:
      tags:
        - Authentication
      summary: Get current user
      description: Get authenticated user information
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User information
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /products:
    get:
      tags:
        - Products
      summary: List products
      description: Get paginated list of products with optional filters
      security:
        - bearerAuth: []
      parameters:
        - name: per_page
          in: query
          schema:
            type: integer
            default: 15
          description: Number of items per page
        - name: search
          in: query
          schema:
            type: string
          description: Search by name, SKU, or description
        - name: category_id
          in: query
          schema:
            type: integer
          description: Filter by category
        - name: vendor_id
          in: query
          schema:
            type: integer
          description: Filter by vendor (admin only)
        - name: is_active
          in: query
          schema:
            type: boolean
          description: Filter by active status
      responses:
        '200':
          description: List of products
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedProducts'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Products
      summary: Create product
      description: Create a new product (Admin/Vendor only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - base_price
              properties:
                category_id:
                  type: integer
                  example: 1
                name:
                  type: string
                  example: "New Laptop"
                slug:
                  type: string
                  example: "new-laptop"
                sku:
                  type: string
                  example: "LAP-002"
                description:
                  type: string
                  example: "High-performance laptop"
                base_price:
                  type: number
                  format: decimal
                  example: 999.99
                is_active:
                  type: boolean
                  default: true
                low_stock_threshold:
                  type: integer
                  default: 10
                initial_stock:
                  type: integer
                  example: 50
                images:
                  type: array
                  items:
                    type: string
                  example: ["image1.jpg"]
                variants:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      sku:
                        type: string
                      price:
                        type: number
                      attributes:
                        type: object
                      initial_stock:
                        type: integer
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Product created successfully"
                  data:
                    $ref: '#/components/schemas/Product'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '422':
          description: Validation error

  /products/{id}:
    get:
      tags:
        - Products
      summary: Get product
      description: Get product details by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Product ID
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Product'
        '404':
          description: Product not found
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

    put:
      tags:
        - Products
      summary: Update product
      description: Update product details (Admin/Vendor only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                category_id:
                  type: integer
                name:
                  type: string
                slug:
                  type: string
                description:
                  type: string
                base_price:
                  type: number
                is_active:
                  type: boolean
                low_stock_threshold:
                  type: integer
                images:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Product'
        '404':
          description: Product not found
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

    delete:
      tags:
        - Products
      summary: Delete product
      description: Delete product (Admin/Vendor only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Product deleted successfully
        '404':
          description: Product not found
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /orders:
    get:
      tags:
        - Orders
      summary: List orders
      description: Get paginated list of orders
      security:
        - bearerAuth: []
      parameters:
        - name: per_page
          in: query
          schema:
            type: integer
            default: 15
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, processing, shipped, delivered, cancelled]
        - name: order_number
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List of orders
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedOrders'
        '401':
          description: Unauthorized

    post:
      tags:
        - Orders
      summary: Create order
      description: Create a new order
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - items
              properties:
                items:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required:
                      - product_id
                      - quantity
                    properties:
                      product_id:
                        type: integer
                      product_variant_id:
                        type: integer
                      quantity:
                        type: integer
                        minimum: 1
                      variant_attributes:
                        type: object
                tax:
                  type: number
                  default: 0
                shipping_fee:
                  type: number
                  default: 0
                discount:
                  type: number
                  default: 0
                currency:
                  type: string
                  default: "USD"
                shipping_address:
                  type: string
                billing_address:
                  type: string
                customer_email:
                  type: string
                customer_phone:
                  type: string
                notes:
                  type: string
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Order'
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '422':
          description: Validation error

  /orders/{id}:
    get:
      tags:
        - Orders
      summary: Get order
      description: Get order details by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Order'
        '404':
          description: Order not found
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /orders/{id}/confirm:
    post:
      tags:
        - Orders
      summary: Confirm order
      description: Confirm order and deduct inventory (Admin/Vendor only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order confirmed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Order'
        '400':
          description: Order cannot be confirmed
        '404':
          description: Order not found
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /orders/{id}/cancel:
    post:
      tags:
        - Orders
      summary: Cancel order
      description: Cancel order and restore inventory
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  example: "Customer requested cancellation"
      responses:
        '200':
          description: Order cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Order'
        '400':
          description: Order cannot be cancelled
        '404':
          description: Order not found
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /orders/{id}/status:
    patch:
      tags:
        - Orders
      summary: Update order status
      description: Update order status (Admin/Vendor only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [pending, processing, shipped, delivered, cancelled]
                notes:
                  type: string
      responses:
        '200':
          description: Order status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Order'
        '404':
          description: Order not found
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '422':
          description: Validation error

  /inventory/add:
    post:
      tags:
        - Inventory
      summary: Add stock
      description: Add inventory stock (Admin/Vendor only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
                - id
                - quantity
              properties:
                type:
                  type: string
                  enum: [product, variant]
                  example: "product"
                id:
                  type: integer
                  example: 1
                quantity:
                  type: integer
                  minimum: 1
                  example: 50
                reason:
                  type: string
                  example: "Restocking"
      responses:
        '200':
          description: Stock added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: object
        '400':
          description: Bad request
        '404':
          description: Item not found
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '422':
          description: Validation error

  /inventory/deduct:
    post:
      tags:
        - Inventory
      summary: Deduct stock
      description: Deduct inventory stock (Admin/Vendor only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
                - id
                - quantity
              properties:
                type:
                  type: string
                  enum: [product, variant]
                  example: "product"
                id:
                  type: integer
                  example: 1
                quantity:
                  type: integer
                  minimum: 1
                  example: 10
                reason:
                  type: string
                  example: "Damaged items"
      responses:
        '200':
          description: Stock deducted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: object
        '400':
          description: Insufficient stock or bad request
        '404':
          description: Item not found
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '422':
          description: Validation error

openapi: 3.0.3
info:
  title: E-Commerce Order Management API
  description: API for managing products, orders, and inventory in an e-commerce system
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: http://localhost/api/v1
    description: Local development server
  - url: https://api.example.com/v1
    description: Production server

tags:
  - name: Authentication
    description: User authentication and authorization
  - name: Products
    description: Product management
  - name: Orders
    description: Order management
  - name: Inventory
    description: Inventory management

paths:
  /register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Create a new user account with role assignment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
                - password_confirmation
              properties:
                name:
                  type: string
                  example: John Doe
                email:
                  type: string
                  format: email
                  example: john@example.com
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: password123
                password_confirmation:
                  type: string
                  format: password
                  example: password123
                role:
                  type: string
                  enum: [admin, vendor, customer]
                  default: customer
                  example: customer
                phone:
                  type: string
                  example: "+1234567890"
                address:
                  type: string
                  example: "123 Main St, City, Country"
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Registration successful
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      access_token:
                        type: string
                      refresh_token:
                        type: string
                      expires_in:
                        type: integer
                        example: 3600
        '422':
          $ref: '#/components/responses/ValidationError'

  /login:
    post:
      tags:
        - Authentication
      summary: Login user
      description: Authenticate user and receive access tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: john@example.com
                password:
                  type: string
                  format: password
                  example: password123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Login successful
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      access_token:
                        type: string
                      refresh_token:
                        type: string
                      expires_in:
                        type: integer
                        example: 3600
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Get a new access token using refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh_token
              properties:
                refresh_token:
                  type: string
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Token refreshed
                  data:
                    type: object
                    properties:
                      access_token:
                        type: string
                      refresh_token:
                        type: string
                      expires_in:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'

  /logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      description: Invalidate refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh_token
              properties:
                refresh_token:
                  type: string
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logout successful

  /me:
    get:
      tags:
        - Authentication
      summary: Get current user
      description: Retrieve authenticated user information
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User information
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /products:
    get:
      tags:
        - Products
      summary: List products
      description: Get paginated list of products with optional filters
      security:
        - bearerAuth: []
      parameters:
        - name: per_page
          in: query
          schema:
            type: integer
            default: 15
        - name: vendor_id
          in: query
          schema:
            type: integer
        - name: category_id
          in: query
          schema:
            type: integer
        - name: is_active
          in: query
          schema:
            type: boolean
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Products list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedProducts'

    post:
      tags:
        - Products
      summary: Create product
      description: Create a new product (vendors create for themselves, admins can specify vendor)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductInput'
      responses:
        '201':
          description: Product created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Product created successfully
                  data:
                    $ref: '#/components/schemas/Product'
        '422':
          $ref: '#/components/responses/ValidationError'

  /products/{id}:
    get:
      tags:
        - Products
      summary: Get product
      description: Retrieve a single product by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Product'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags:
        - Products
      summary: Update product
      description: Update an existing product
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductUpdate'
      responses:
        '200':
          description: Product updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Product updated successfully
                  data:
                    $ref: '#/components/schemas/Product'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Products
      summary: Delete product
      description: Delete a product
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Product deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Product deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'

  /orders:
    get:
      tags:
        - Orders
      summary: List orders
      description: Get paginated list of orders (customers see only their orders)
      security:
        - bearerAuth: []
      parameters:
        - name: per_page
          in: query
          schema:
            type: integer
            default: 15
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, processing, shipped, delivered, cancelled]
        - name: order_number
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Orders list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedOrders'

    post:
      tags:
        - Orders
      summary: Create order
      description: Create a new order
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderInput'
      responses:
        '201':
          description: Order created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Order created successfully
                  data:
                    $ref: '#/components/schemas/Order'
        '422':
          $ref: '#/components/responses/ValidationError'

  /orders/{id}:
    get:
      tags:
        - Orders
      summary: Get order
      description: Retrieve a single order by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Order'
        '404':
          $ref: '#/components/responses/NotFound'

  /orders/{id}/confirm:
    post:
      tags:
        - Orders
      summary: Confirm order
      description: Confirm a pending order (admin/vendor only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order confirmed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Order confirmed successfully
                  data:
                    $ref: '#/components/schemas/Order'
        '400':
          description: Bad request
        '404':
          $ref: '#/components/responses/NotFound'

  /orders/{id}/cancel:
    post:
      tags:
        - Orders
      summary: Cancel order
      description: Cancel an order
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  example: Customer requested cancellation
      responses:
        '200':
          description: Order cancelled
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Order cancelled successfully
                  data:
                    $ref: '#/components/schemas/Order'
        '404':
          $ref: '#/components/responses/NotFound'

  /orders/{id}/status:
    patch:
      tags:
        - Orders
      summary: Update order status
      description: Update order status (admin/vendor only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [pending, processing, shipped, delivered, cancelled]
                notes:
                  type: string
      responses:
        '200':
          description: Status updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Order status updated successfully
                  data:
                    $ref: '#/components/schemas/Order'
        '422':
          $ref: '#/components/responses/ValidationError'

  /inventory/add:
    post:
      tags:
        - Inventory
      summary: Add stock
      description: Add stock to a product or variant (admin/vendor only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
                - id
                - quantity
              properties:
                type:
                  type: string
                  enum: [product, variant]
                  example: product
                id:
                  type: integer
                  example: 1
                quantity:
                  type: integer
                  minimum: 1
                  example: 50
                reason:
                  type: string
                  example: Restocking
      responses:
        '200':
          description: Stock added
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Stock added successfully
                  data:
                    type: object
        '404':
          $ref: '#/components/responses/NotFound'

  /inventory/deduct:
    post:
      tags:
        - Inventory
      summary: Deduct stock
      description: Deduct stock from a product or variant (admin/vendor only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
                - id
                - quantity
              properties:
                type:
                  type: string
                  enum: [product, variant]
                  example: product
                id:
                  type: integer
                  example: 1
                quantity:
                  type: integer
                  minimum: 1
                  example: 10
                reason:
                  type: string
                  example: Damaged goods
      responses:
        '200':
          description: Stock deducted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Stock deducted successfully
                  data:
                    type: object
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
        role:
          type: string
          enum: [admin, vendor, customer]
        phone:
          type: string
        address:
          type: string
        created_at:
          type: string
          format: date-time

    Product:
      type: object
      properties:
        id:
          type: integer
        vendor_id:
          type: integer
        category_id:
          type: integer
        name:
          type: string
        slug:
          type: string
        sku:
          type: string
        description:
          type: string
        base_price:
          type: number
        is_active:
          type: boolean
        low_stock_threshold:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ProductInput:
      type: object
      required:
        - name
        - base_price
      properties:
        category_id:
          type: integer
        name:
          type: string
        slug:
          type: string
        sku:
          type: string
        description:
          type: string
        base_price:
          type: number
          minimum: 0
        is_active:
          type: boolean
        low_stock_threshold:
          type: integer
        initial_stock:
          type: integer
        variants:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              sku:
                type: string
              price:
                type: number
              attributes:
                type: object
              initial_stock:
                type: integer

    ProductUpdate:
      type: object
      properties:
        category_id:
          type: integer
        name:
          type: string
        slug:
          type: string
        description:
          type: string
        base_price:
          type: number
        is_active:
          type: boolean
        low_stock_threshold:
          type: integer

    Order:
      type: object
      properties:
        id:
          type: integer
        order_number:
          type: string
        customer_id:
          type: integer
        status:
          type: string
        subtotal:
          type: number
        tax:
          type: number
        shipping_fee:
          type: number
        discount:
          type: number
        total:
          type: number
        currency:
          type: string
        shipping_address:
          type: string
        billing_address:
          type: string
        customer_email:
          type: string
        customer_phone:
          type: string
        notes:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        created_at:
          type: string
          format: date-time

    OrderItem:
      type: object
      properties:
        id:
          type: integer
        product_id:
          type: integer
        product_variant_id:
          type: integer
        product_name:
          type: string
        product_sku:
          type: string
        quantity:
          type: integer
        unit_price:
          type: number
        subtotal:
          type: number
        tax:
          type: number
        total:
          type: number

    OrderInput:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - product_id
              - quantity
            properties:
              product_id:
                type: integer
              product_variant_id:
                type: integer
              quantity:
                type: integer
                minimum: 1
              variant_attributes:
                type: object
        tax:
          type: number
        shipping_fee:
          type: number
        discount:
          type: number
        currency:
          type: string
        shipping_address:
          type: string
        billing_address:
          type: string
        customer_email:
          type: string
        customer_phone:
          type: string
        notes:
          type: string

    PaginatedProducts:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Product'
        current_page:
          type: integer
        per_page:
          type: integer
        total:
          type: integer
        last_page:
          type: integer

    PaginatedOrders:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Order'
        current_page:
          type: integer
        per_page:
          type: integer
        total:
          type: integer
        last_page:
          type: integer

  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: Invalid credentials

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: Resource not found

    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            type: object
            properties:
              errors:
                type: object
                additionalProperties:
                  type: array
                  items:
                    type: string
